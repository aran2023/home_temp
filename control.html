<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ë€ì˜ ìœ ì„  ë¦¬ëª¨ì»¨</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #222; color: white; }
        h2 { margin-bottom: 30px; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            font-size: 1.2rem; padding: 15px 30px; margin: 10px;
            border: none; border-radius: 50px; cursor: pointer;
            width: 80%; max-width: 300px; transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); } /* ëˆŒë €ì„ ë•Œ ì›€ì°” íš¨ê³¼ */

        #btn-connect { background: #ff9800; color: black; font-weight: bold; }
        #btn-on { background: #4caf50; color: white; opacity: 0.5; pointer-events: none; } /* ì²˜ìŒì—” ë¹„í™œì„± */
        #btn-off { background: #f44336; color: white; opacity: 0.5; pointer-events: none; }
        
        /* í™œì„±í™” ë˜ì—ˆì„ ë•Œ */
        .active { opacity: 1 !important; pointer-events: auto !important; }
        
        #log { margin-top: 20px; color: #aaa; font-size: 0.9rem; white-space: pre-wrap; }
    </style>
</head>
<body>

    <h2>ğŸ”Œ USB ìœ ì„  ë¦¬ëª¨ì»¨</h2>

    <button id="btn-connect" onclick="connectSerial()">Step 1. ê¸°ê¸° ì—°ê²°í•˜ê¸°</button>
    
    <hr style="margin: 30px 0; border-color: #444;">

    <button id="btn-on" onclick="sendSignal('1')">ğŸ’¡ LED ì¼œê¸°</button>
    <br>
    <button id="btn-off" onclick="sendSignal('0')">âš« LED ë„ê¸°</button>

    <div id="log">ì—°ê²° ëŒ€ê¸° ì¤‘...</div>

    <script>
        let port;
        let writer;

        // [í•µì‹¬ 1] ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²°í•˜ê¸°
        async function connectSerial() {
            // ë¸Œë¼ìš°ì €ê°€ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
            if (!("serial" in navigator)) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ì‹œë¦¬ì–¼ í†µì‹ ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n(ì•ˆë“œë¡œì´ë“œ í¬ë¡¬, PC í¬ë¡¬ë§Œ ê°€ëŠ¥)");
                return;
            }

            try {
                // 1. í¬íŠ¸ ì„ íƒì°½ ë„ìš°ê¸°
                port = await navigator.serial.requestPort();
                
                // 2. í¬íŠ¸ ì—´ê¸° (ì†ë„ 115200 í•„ìˆ˜!)
                await port.open({ baudRate: 115200 });

                // 3. ê¸€ì“°ê¸° ë„êµ¬ ì¤€ë¹„
                const textEncoder = new TextEncoderStream();
                const writableStreamClosed = textEncoder.readable.pipeTo(port.writable);
                writer = textEncoder.writable.getWriter();

                // 4. UI ë³€ê²½ (ë²„íŠ¼ í™œì„±í™”)
                document.getElementById('log').innerText = "âœ… ì—°ê²° ì„±ê³µ! ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.";
                document.getElementById('btn-connect').style.display = 'none'; // ì—°ê²°ë²„íŠ¼ ìˆ¨ê¹€
                document.getElementById('btn-on').classList.add('active');
                document.getElementById('btn-off').classList.add('active');

            } catch (error) {
                console.error(error);
                document.getElementById('log').innerText = "âŒ ì—°ê²° ì‹¤íŒ¨: " + error;
            }
        }

        // [í•µì‹¬ 2] ì‹ í˜¸ ë³´ë‚´ê¸° (1 ë˜ëŠ” 0)
        async function sendSignal(command) {
            if (writer) {
                try {
                    await writer.write(command); // '1' ë˜ëŠ” '0' ì „ì†¡
                    document.getElementById('log').innerText = "ğŸ“¤ ì‹ í˜¸ ì „ì†¡: " + (command === '1' ? "ON" : "OFF");
                } catch (error) {
                    document.getElementById('log').innerText = "âŒ ì „ì†¡ ì˜¤ë¥˜: " + error;
                }
            }
        }
    </script>

</body>
</html>